<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Halloween WebXR Event</title>
    <style>
        body { margin: 0; overflow: hidden; }
        #enterVR {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: orange;
            color: white;
            font-size: 18px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #enterVR:hover {
            background: darkorange;
        }
    </style>
</head>
<body>
    <button id="enterVR">Enter VR</button>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r148/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.148.0/examples/jsm/webxr/VRButton.js"></script>
    <script>
        // Initialize scene, camera, and renderer
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000); // Black background for night

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1.6, 3); // Typical eye height in meters

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.xr.enabled = true;
        document.body.appendChild(renderer.domElement);

        // Add VR Button
        document.body.appendChild(VRButton.createButton(renderer));

        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Add ambient light
        const ambientLight = new THREE.AmbientLight(0x404040, 2); // Soft white light
        scene.add(ambientLight);

        // Add directional light for spooky effect
        const directionalLight = new THREE.DirectionalLight(0xffaa33, 1);
        directionalLight.position.set(5, 10, 7.5);
        scene.add(directionalLight);

        // Create ground
        const groundGeometry = new THREE.PlaneGeometry(20, 20);
        const groundMaterial = new THREE.MeshStandardMaterial({ color: 0x222222 });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // Function to create a pumpkin
        function createPumpkin(x, z) {
            const pumpkinGroup = new THREE.Group();

            // Pumpkin body
            const pumpkinGeometry = new THREE.SphereGeometry(0.5, 32, 32);
            const pumpkinMaterial = new THREE.MeshStandardMaterial({ color: 0xff6600 });
            const pumpkin = new THREE.Mesh(pumpkinGeometry, pumpkinMaterial);
            pumpkin.position.y = 0.5;
            pumpkinGroup.add(pumpkin);

            // Pumpkin stem
            const stemGeometry = new THREE.CylinderGeometry(0.05, 0.05, 0.2, 8);
            const stemMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513 });
            const stem = new THREE.Mesh(stemGeometry, stemMaterial);
            stem.position.y = 0.7;
            stem.rotation.x = Math.PI / 4;
            pumpkinGroup.add(stem);

            // Position the pumpkin
            pumpkinGroup.position.set(x, 0, z);

            scene.add(pumpkinGroup);
        }

        // Add multiple pumpkins
        createPumpkin(-2, -2);
        createPumpkin(2, -2);
        createPumpkin(-2, 2);
        createPumpkin(2, 2);
        createPumpkin(0, 0);

        // Add some spooky fog
        const fog = new THREE.FogExp2(0x111111, 0.05);
        scene.fog = fog;

        // Add animated ghosts
        function createGhost(x, y, z) {
            const ghostGeometry = new THREE.SphereGeometry(0.2, 16, 16);
            const ghostMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff, transparent: true, opacity: 0.8 });
            const ghost = new THREE.Mesh(ghostGeometry, ghostMaterial);
            ghost.position.set(x, y, z);
            scene.add(ghost);

            // Animate the ghost
            const speed = Math.random() * 0.5 + 0.5;
            const direction = Math.random() > 0.5 ? 1 : -1;
            const amplitude = Math.random() * 2 + 1;

            ghost.userData = { speed, direction, amplitude, initialY: y };

            return ghost;
        }

        const ghosts = [];
        for (let i = 0; i < 5; i++) {
            ghosts.push(createGhost(
                Math.random() * 10 - 5,
                Math.random() * 2 + 1,
                Math.random() * 10 - 5
            ));
        }

        // Animation loop
        function animate() {
            renderer.setAnimationLoop(render);
        }

        function render(time) {
            // Animate ghosts
            ghosts.forEach(ghost => {
                ghost.position.y = ghost.userData.initialY + Math.sin(time * 0.001 * ghost.userData.speed) * 0.5;
                ghost.position.x += Math.cos(time * 0.001 * ghost.userData.speed * ghost.userData.direction) * 0.01;
                ghost.position.z += Math.sin(time * 0.001 * ghost.userData.speed * ghost.userData.direction) * 0.01;
            });

            renderer.render(scene, camera);
        }

        animate();

        // Optional: Add event listener for custom VR button
        const enterVRButton = document.getElementById('enterVR');
        enterVRButton.addEventListener('click', () => {
            renderer.xr.enabled = true;
            navigator.xr.requestSession('immersive-vr').then(session => {
                renderer.xr.setSession(session);
            });
        });
    </script>
</body>
</html>
